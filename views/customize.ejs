<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Customize Interface</title>
    <link rel="stylesheet" href="/styles.css" />
    <style>
      .form-container {
        max-width: 800px;
        margin: auto;
        padding: 20px;
        border: 1px solid #ccc;
        border-radius: 10px;
      }
      .form-group {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 15px;
        margin-bottom: 15px;
      }
      .form-group label {
        grid-column: span 2;
        margin-bottom: 5px;
      }
      .preview {
        margin: 20px;
        padding: 20px;
        border: 1px solid #ccc;
      }
      .form-group input[type="color"] {
        width: 100%;
        height: 40px;
        padding: 0;
        border: none;
        cursor: pointer;
      }
      .form-group button {
        padding: 15px 20px;
        font-size: 16px;
        background-color: #007883;
        color: white;
        border: none;
        cursor: pointer;
      }
      .form-group button:hover {
        background-color: #005f66;
      }
      .save-button {
        background-color: #4caf50 !important;
        color: white;
        padding: 15px 20px;
        font-size: 16px;
        border: none;
        cursor: pointer;
        border-radius: 4px;
        transition: background-color 0.3s;
      }
      .save-button:hover {
        background-color: #337937 !important;
      }
      .button-container {
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      .button-container .form-group {
        width: 100%;
        display: flex;
        justify-content: center;
      }
    </style>
  </head>
  <body>
    <h1>Customize Interface</h1>
    <div class="form-container" id="form-container">
      <form id="customize-form" method="post" action="/customize">
        <div class="form-group">
          <div>
            <label for="page-header-color">Page Header Color</label>
            <input
              type="color"
              id="page-header-color"
              name="pageHeaderColor"
              value="<%= customizations.page_header_color %>"
            />
          </div>
          <div>
            <label for="table-header-color">Table Header Color</label>
            <input
              type="color"
              id="table-header-color"
              name="tableHeaderColor"
              value="<%= customizations.table_header_color %>"
            />
          </div>
          <div>
            <label for="table-row-odd-color">Table Row Odd Numbers Color</label>
            <input
              type="color"
              id="table-row-odd-color"
              name="tableRowOddColor"
              value="<%= customizations.table_row_odd_color %>"
            />
          </div>
          <div>
            <label for="table-row-even-color"
              >Table Row Even Numbers Color</label
            >
            <input
              type="color"
              id="table-row-even-color"
              name="tableRowEvenColor"
              value="<%= customizations.table_row_even_color %>"
            />
          </div>
          <div>
            <label for="page-header-font-color">Page Header Font Color</label>
            <input
              type="color"
              id="page-header-font-color"
              name="pageHeaderFontColor"
              value="<%= customizations.page_header_font_color %>"
            />
          </div>
          <div>
            <label for="table-header-font-color">Table Header Font Color</label>
            <input
              type="color"
              id="table-header-font-color"
              name="tableHeaderFontColor"
              value="<%= customizations.table_header_font_color %>"
            />
          </div>
          <div>
            <label for="table-row-odd-font-color"
              >Table Row Odd Numbers Font Color</label
            >
            <input
              type="color"
              id="table-row-odd-font-color"
              name="tableRowOddFontColor"
              value="<%= customizations.table_row_odd_font_color %>"
            />
          </div>
          <div>
            <label for="table-row-even-font-color"
              >Table Row Even Numbers Font Color</label
            >
            <input
              type="color"
              id="table-row-even-font-color"
              name="tableRowEvenFontColor"
              value="<%= customizations.table_row_even_font_color %>"
            />
          </div>
        </div>
      </form>
    </div>
    <div class="preview" id="preview">
      <h1>To-Do List Preview</h1>
      <table>
        <thead>
          <tr>
            <th>Title</th>
            <th>Description</th>
            <th>Priority</th>
            <th>Time Added</th>
            <th>Due Date</th>
            <th>Edit</th>
            <th>Delete</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Sample Title 1</td>
            <td>Sample Description 1</td>
            <td>High</td>
            <td>Sample Time 1</td>
            <td>Sample Due Date 1</td>
            <td>Edit</td>
            <td>Delete</td>
          </tr>
          <tr>
            <td>Sample Title 2</td>
            <td>Sample Description 2</td>
            <td>Medium</td>
            <td>Sample Time 2</td>
            <td>Sample Due Date 2</td>
            <td>Edit</td>
            <td>Delete</td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="button-container">
      <div class="form-group">
        <button type="submit" form="customize-form" class="save-button">
          Save Customizations
        </button>
      </div>
      <div class="form-group">
        <button type="button" onclick="resetToDefault()">
          Reset to Default
        </button>
      </div>
      <div class="form-group">
        <button type="button" onclick="returnToTodoList()">
          Return to Todo-List
        </button>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const saveButton = document.querySelector(".save-button");
        saveButton.addEventListener("mouseover", function () {
          saveButton.style.backgroundColor = "#337937";
        });
        saveButton.addEventListener("mouseout", function () {
          saveButton.style.backgroundColor = "#4CAF50";
        });

        function updatePreview() {
          const pageHeaderColor =
            document.getElementById("page-header-color").value;
          const pageHeaderFontColor = document.getElementById(
            "page-header-font-color"
          ).value;
          const tableHeaderColor =
            document.getElementById("table-header-color").value;
          const tableHeaderFontColor = document.getElementById(
            "table-header-font-color"
          ).value;
          const tableRowOddColor = document.getElementById(
            "table-row-odd-color"
          ).value;
          const tableRowOddFontColor = document.getElementById(
            "table-row-odd-font-color"
          ).value;
          const tableRowEvenColor = document.getElementById(
            "table-row-even-color"
          ).value;
          const tableRowEvenFontColor = document.getElementById(
            "table-row-even-font-color"
          ).value;

          const previewHeader = document.querySelector("#preview h1");
          const previewTableHeaders = document.querySelectorAll("#preview th");
          const previewOddRows = document.querySelectorAll(
            "#preview tbody tr:nth-child(odd)"
          );
          const previewEvenRows = document.querySelectorAll(
            "#preview tbody tr:nth-child(even)"
          );

          previewHeader.style.backgroundColor = pageHeaderColor;
          previewHeader.style.color = pageHeaderFontColor;

          previewTableHeaders.forEach((th) => {
            th.style.backgroundColor = tableHeaderColor;
            th.style.color = tableHeaderFontColor;
          });

          previewOddRows.forEach((row) => {
            row.style.backgroundColor = tableRowOddColor;
            row.style.color = tableRowOddFontColor;
          });

          previewEvenRows.forEach((row) => {
            row.style.backgroundColor = tableRowEvenColor;
            row.style.color = tableRowEvenFontColor;
          });
        }

        document
          .getElementById("customize-form")
          .addEventListener("input", updatePreview);

        window.resetToDefault = function () {
          if (confirm("Are you sure you want to reset to default settings?")) {
            const defaultColors = {
              page_header_color: "#007883",
              page_header_font_color: "#FFFFFF",
              table_header_color: "#007883",
              table_header_font_color: "#FFFFFF",
              table_row_odd_color: "#FFFFFF",
              table_row_odd_font_color: "#000000",
              table_row_even_color: "#7fedf3",
              table_row_even_font_color: "#000000",
            };

            document.getElementById("page-header-color").value =
              defaultColors.page_header_color;
            document.getElementById("page-header-font-color").value =
              defaultColors.page_header_font_color;
            document.getElementById("table-header-color").value =
              defaultColors.table_header_color;
            document.getElementById("table-header-font-color").value =
              defaultColors.table_header_font_color;
            document.getElementById("table-row-odd-color").value =
              defaultColors.table_row_odd_color;
            document.getElementById("table-row-odd-font-color").value =
              defaultColors.table_row_odd_font_color;
            document.getElementById("table-row-even-color").value =
              defaultColors.table_row_even_color;
            document.getElementById("table-row-even-font-color").value =
              defaultColors.table_row_even_font_color;

            // Update preview immediately
            updatePreview();
          }
        };

        document
          .getElementById("customize-form")
          .addEventListener("submit", function (event) {
            event.preventDefault();

            const customizations = {
              pageHeaderColor:
                document.getElementById("page-header-color").value,
              pageHeaderFontColor: document.getElementById(
                "page-header-font-color"
              ).value,
              tableHeaderColor:
                document.getElementById("table-header-color").value,
              tableHeaderFontColor: document.getElementById(
                "table-header-font-color"
              ).value,
              tableRowOddColor: document.getElementById("table-row-odd-color")
                .value,
              tableRowOddFontColor: document.getElementById(
                "table-row-odd-font-color"
              ).value,
              tableRowEvenColor: document.getElementById("table-row-even-color")
                .value,
              tableRowEvenFontColor: document.getElementById(
                "table-row-even-font-color"
              ).value,
            };

            console.log("Customizations being sent:", customizations);

            // Save to the server
            fetch("/customize", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(customizations),
            })
              .then((response) => {
                if (!response.ok) {
                  throw new Error("Failed to save customizations");
                }
                console.log("Server response:", response);
                return response.json();
              })
              .then((data) => {
                alert("Customizations saved!");
                // Optionally update the UI or redirect
                window.location.href = "/main_processes"; // Redirect to the main page
              })
              .catch((error) => {
                console.error("Error saving customizations:", error);
                alert("There was an error saving your customizations.");
              });
          });

        // Load the customizations from the database and update the preview
        updatePreview();
      });

      window.returnToTodoList = function () {
        if (
          confirm(
            "Would you like to return to your todo-list? Your changes will not be saved."
          )
        ) {
          window.location.href = "main_processes";
        }
      };
    </script>
  </body>
</html>
